//////////////////////////////////////
// INITIAL SETTINGS

UserName = GetUserInfos().PlayerName
UniverseName = GetUniverseName()
Language = GetLanguage()

telegramId = TELEGRAM_CHAT_ID

fsMade = 0

//////////////////////////////////////
// SENDING FUNCTIONS

func SendAll(msg) {
    Print(msg)
    SendTelegram(telegramId, msg)
//    SendDiscord(DISCORD_WEBHOOK_URL, msg)
}


//////////////////////////////////////
// START

intro = "🚀 Starting fleet dispatch from Moons to Planets " + UserName + " (" + UniverseName + " | " + Language + ")"
SendAll(intro)

moons = GetCachedMoons()

for moon in moons {
    origin = moon.Coordinate
    destination = NewCoordinate(origin.Galaxy, origin.System, origin.Position, PLANET_TYPE)

    // Simulate a human-like analysis pause
    Sleep(Random(1000, 3000))

    // Fleet creation
    fleet = NewFleet()
    fleet.SetOrigin(origin)
    fleet.SetDestination(destination)
    fleet.SetMission(PARK)
    fleet.AddShips(LARGECARGO, 5000)

    // Fleet dispatch
    fleet, err = fleet.SendNow()

    if err != nil {
        errorMsg = "⚠️ Error sending fleet\n🌙 From: " + origin + "\n🪐 To: " + destination + "\n❌ Error: " + err
        LogError(err)
        SendAll(errorMsg)
        Sleep(Random(1000, 2000))
    } else {
        successMsg = "✅ Fleet sent successfully!\n🌙 From: " + origin + "\n🪐 To: " + destination + "\n🚚 Mission: Park"
        fsMade += 1
        SendAll(successMsg)
        Sleep(Random(7000, 15000))  // More human-like delay
    }
}

//////////////////////////////////////
// FINALIZATION

conclusion = "🎯 End of process by " + UserName + " (" + UniverseName + " | " + Language + ")"
summary = "📦 Total fleets sent successfully: " + fsMade

SendAll(conclusion)
SendAll(summary)
